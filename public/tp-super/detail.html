<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Détail du superhéros</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://unpkg.com/axios@latest"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <div id="navbar_placeholder"></div>

    <main class="container my-4" id="detailApp">
      <div v-if="!loaded">Chargement...</div>
      <div v-if="loaded && hero">
        <div class="d-flex gap-4 align-items-start">
          <img :src="hero.images?.lg" class="rounded" alt="" width="240">
          <div>
            <h1>{{ hero.name }}</h1>
            
            <!-- Statistiques de pouvoir -->
            <div class="card mb-3">
              <div class="card-header"><h4 class="mb-0">Pouvoirs</h4></div>
              <div class="card-body">
                <div v-for="(value, key) in powerstats" :key="key" class="mb-2">
                  <label class="fw-bold">{{ key.charAt(0).toUpperCase() + key.slice(1) }}:</label>
                  <div class="progress">
                    <div class="progress-bar" :style="{ width: value + '%' }" :class="getColorClass(value)">
                      {{ value }}
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Apparence -->
            <div class="card mb-3">
              <div class="card-header"><h4 class="mb-0">Apparence</h4></div>
              <div class="card-body">
                <div v-for="(value, key) in appearance" :key="key" class="mb-2">
                  <strong>{{ key.charAt(0).toUpperCase() + key.slice(1) }}:</strong>
                  {{ Array.isArray(value) ? value.join(' / ') : value }}
                </div>
              </div>
            </div>

            <!-- Biographie -->
            <div class="card mb-3">
              <div class="card-header"><h4 class="mb-0">Biographie</h4></div>
              <div class="card-body">
                <div v-for="(value, key) in biography" :key="key" class="mb-2">
                  <strong>{{ formatBioKey(key) }}:</strong>
                  {{ Array.isArray(value) ? value.join(', ') : value }}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div v-if="loaded && !hero">Héros introuvable.</div>
    </main>

    <script>
    fetch('navbar.html').then(r=>r.text()).then(html=>document.getElementById('navbar_placeholder').innerHTML = html).catch(()=>{});
    const { createApp } = Vue;
    createApp({
      data() { 
        return { 
          hero: null, 
          powerstats: {}, 
          appearance: {}, 
          biography: {}, 
          loaded: false 
        }; 
      },
      methods: {
        getColorClass(value) {
          if (value >= 80) return 'bg-success';
          if (value >= 60) return 'bg-info';
          if (value >= 40) return 'bg-warning';
          return 'bg-danger';
        },
        formatBioKey(key) {
          // Convertit "full-name" en "Nom complet"
          return key.split('-')
            .map(word => word.charAt(0).toUpperCase() + word.slice(1))
            .join(' ');
        }
      },
      mounted() {
        const params = new URLSearchParams(location.search);
        const id = params.get('id');
        if (!id) { 
          this.loaded = true; 
          return; 
        }

        const base = 'https://cdn.jsdelivr.net/gh/rtomczak/superhero-api@0.3.0/api';
        Promise.all([
          axios.get(`${base}/id/${id}.json`).then(r => this.hero = r.data),
          axios.get(`${base}/powerstats/${id}.json`).then(r => this.powerstats = r.data),
          axios.get(`${base}/appearance/${id}.json`).then(r => this.appearance = r.data),
          axios.get(`${base}/biography/${id}.json`).then(r => this.biography = r.data)
        ]).catch(error => {
          console.error('Erreur chargement:', error);
        }).finally(() => {
          this.loaded = true;
        });
      }
    }).mount('#detailApp');
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
